(window.webpackJsonp=window.webpackJsonp||[]).push([[6,85],{EiDx:function(t,e,a){"use strict";a.r(e);var o=a("b60y"),i=a.n(o),s={name:"wangeditor",data:function(){return{editorContent:""}},props:{content:{type:String},disabled:{default:!1}},watch:{content:function(t,e){this.wEditor.txt.html(t)}},methods:{getContent:function(){return this.wEditor.txt.html()},setContent:function(){this.wEditor.txt.html(this.content)},clearContent:function(){this.wEditor.txt.clear()}},mounted:function(){var t=this,e=this;this.wEditor=new i.a(this.$refs.editor);var a=this.wEditor;a.config.customUploadImg=function(t,a){var o=new FormData;o.append("file",t[0]),e.$request.upload(o).then((function(t){a(t.data.data.split(",")[1])}))},a.config.uploadImgServer="http://47.118.43.170:8080/api/cos/upload",a.config.onchange=function(e){t.editorContent=e},a.create(),a.txt.html(this.content),this.disabled?a.$textElem.attr("contenteditable",!1):a.$textElem.attr("contenteditable",!0)}},r=a("KHd+"),n=Object(r.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{ref:"editor",staticStyle:{"text-align":"left"}})])}),[],!1,null,"b0be8218",null);e.default=n.exports},GQeE:function(t,e,a){t.exports={default:a("iq4v"),__esModule:!0}},Mqbl:function(t,e,a){var o=a("JB68"),i=a("w6GO");a("zn7N")("keys",(function(){return function(t){return i(o(t))}}))},PhMT:function(t,e,a){},iq4v:function(t,e,a){a("Mqbl"),t.exports=a("WEpk").Object.keys},kQGP:function(t,e,a){"use strict";var o=a("PhMT");a.n(o).a},zn7N:function(t,e,a){var o=a("Y7ZC"),i=a("WEpk"),s=a("KUxP");t.exports=function(t,e){var a=(i.Object||{})[t]||Object[t],r={};r[t]=e(a),o(o.S+o.F*s((function(){a(1)})),"Object",r)}},zyjI:function(t,e,a){"use strict";a.r(e);var o=a("GQeE"),i=a.n(o),s={components:{wangEditor:a("EiDx").default},data:function(){return{defaultContent:"<p>请输入题目</p>",parentid:"",activeName:"first",fileImg:[],uploadImgList:[],header:{"Content-Type":"multipart/form-data"},dialogImageUrl:"",dialogVisible:!1,form:{newsImagesCodes:void 0,newsVideoCodes:void 0,newsTitle:void 0,newsType:void 0,newsContent:void 0},newsTypeMap:[],rules:{newsTitle:[{required:!0,message:"标题不能为空",trigger:"change"}],newsType:[{required:!0,message:"新闻类型不能为空",trigger:"change"}]}}},created:function(){var t=this;this.$request.findAlleuemsNews().then((function(e){for(var a=[],o=e.data.data,s=0;s<i()(o.newsTypeMap).length;s++){var r={};r.value=i()(o.newsTypeMap)[s],r.label=o.newsTypeMap[i()(o.newsTypeMap)[s]],a.push(r)}t.newsTypeMap=a}))},mounted:function(){var t=this;this.$route.params.id?(localStorage.setItem("editID",this.$route.params.id),this.parentid=this.$route.params.id):this.parentid=localStorage.getItem("editID"),this.$request.findByIdNews(this.parentid).then((function(e){e.data.data.newsType=e.data.data.newsType.toString(),t.uploadImgList.push({code:e.data.data.newsImagesCodes,url:e.data.data.newsImagesCodesValue}),e.data.data.newsImagesCodesValue&&t.fileImg.push({uid:1,url:e.data.data.newsImagesCodesValue}),t.form=e.data.data}))},methods:{uploadVadioFile:function(t){var e=this,a=new FormData;console.log(t),a.append("file",t.file),this.$request.upload(a).then((function(t){null!=e.form.newsVideoCodes?e.form.newsVideoCodes=e.form.newsVideoCodes+","+t.data.data.split(",")[0]:e.form.newsVideoCodes=t.data.data.split(",")[0]}))},uploadSectionFile:function(t){var e=this,a=new FormData;a.append("file",t.file),this.$request.upload(a).then((function(t){var a={url:t.data.data.split(",")[1]};e.fileImg.push(a),e.uploadImgList.push({code:t.data.data.split(",")[0],url:t.data.data.split(",")[1]})}))},getLocalImg:function(t){var e=t.url;this.dialogImageUrl=e,this.dialogVisible=!0},getLocalImgs:function(t,e){var a=this;this.uploadImgList.forEach((function(e,o){e.url==t.url&&a.uploadImgList.splice(o,1)}))},cancel:function(t){this.$router.go(-1),this.$store.dispatch("removeTab",{tabItem:t,fullPath:this.$route.fullPath,router:this.$router})},submitForm:function(t,e){var a=this;""!=this.$refs.wangeditor.editorContent?(this.form.newsContent=this.$refs.wangeditor.editorContent,this.form.userCode=JSON.parse(localStorage.getItem("userInfo")).userCode,this.$refs.form.validate((function(o){if(o){for(var i=[],s=0;s<a.uploadImgList.length;s++)i.push(a.uploadImgList[s].code),console.log(a.uploadImgList[s].code);a.form.newsImagesCodes=i.toString(),0==e?a.$request.updateNews(a.form).then((function(e){200==e.data.status?(a.$router.go(-1),a.$store.dispatch("removeTab",{tabItem:t,fullPath:a.$route.fullPath,router:a.$router}),a.msgSuccess("修改成功")):a.$message.error(e.data.msg)})):1==e&&a.$request.publisUpdateNews(a.form).then((function(e){200==e.data.status?(a.$router.go(-1),a.$store.dispatch("removeTab",{tabItem:t,fullPath:a.$route.fullPath,router:a.$router}),a.msgSuccess("修改成功")):a.$message.error(e.data.msg)}))}}))):this.$message.error("内容不能为空")}}},r=(a("kQGP"),a("KHd+")),n=Object(r.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contant"},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"图文类型:",prop:"newsType"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.form.newsType,callback:function(e){t.$set(t.form,"newsType",e)},expression:"form.newsType"}},t._l(t.newsTypeMap,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"图文标题:",prop:"newsTitle"}},[a("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.form.newsTitle,callback:function(e){t.$set(t.form,"newsTitle",e)},expression:"form.newsTitle"}})],1),t._v(" "),a("el-form-item",[a("el-tabs",{attrs:{stretch:!1},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"通知封面上传",name:"first"}},[a("el-upload",{ref:"upload",attrs:{action:"uploadUrl","list-type":"picture-card","http-request":t.uploadSectionFile,headers:t.header,limit:1,"with-credentials":!0,accept:"image/png, image/gif, image/jpg, image/jpeg","on-preview":t.getLocalImg,"on-remove":t.getLocalImgs,"file-list":t.fileImg}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),t._v(" "),a("el-tab-pane",{attrs:{label:"内容视频上传",name:"fourth"}},[a("el-upload",{ref:"uploadVadio",attrs:{action:"uploadUrl","list-type":"picture-card",limit:1,"http-request":t.uploadVadioFile,headers:t.header,"with-credentials":!0}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"内容详情:",prop:"userSex"}},[a("wang-editor",{ref:"wangeditor",attrs:{content:t.form.newsContent}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:function(e){return t.cancel(t.$store.getters.rightNav)}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm(t.$store.getters.rightNav,0)}}},[t._v("不发布修改")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm(t.$store.getters.rightNav,1)}}},[t._v("发布修改")])],1),t._v(" "),a("el-dialog",{attrs:{width:"600px",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)}),[],!1,null,"81a2337a",null);e.default=n.exports}}]);
//# sourceMappingURL=6.a3e440a350bf242a5862.js.map